<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Visualiseur de fichier XLSB</title>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">
  <div class="container">
    <h1 class="mb-4">Visualiseur de fichier Excel (.xlsb)</h1>
    <input type="file" id="upload" accept=".xlsb" class="form-control mb-3">

    <div class="mb-3">
      <label for="sheetSelector" class="form-label">Choisir une feuille :</label>
      <select id="sheetSelector" class="form-select"></select>
    </div>

    <div id="output" class="table-responsive"></div>
  </div>

  <script>
    let workbookGlobal;

    document.getElementById('upload').addEventListener('change', handleFile, false);
    document.getElementById('sheetSelector').addEventListener('change', function() {
      const sheetName = this.value;
      renderSheet(sheetName);
    });

    function handleFile(e) {
      const file = e.target.files[0];
      const reader = new FileReader();

      reader.onload = function(e) {
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type: 'array'});

        workbookGlobal = workbook; // stocker globalement
        populateSheetSelector(workbook.SheetNames);
        renderSheet(workbook.SheetNames[0]); // afficher la premiÃ¨re feuille
      };

      reader.readAsArrayBuffer(file);
    }

    function populateSheetSelector(sheetNames) {
      const selector = document.getElementById('sheetSelector');
      selector.innerHTML = '';
      sheetNames.forEach(name => {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        selector.appendChild(option);
      });
    }

    function renderSheet(sheetName) {
      const worksheet = workbookGlobal.Sheets[sheetName];
      const jsonData = XLSX.utils.sheet_to_json(worksheet, {header: 1});
      renderTable(jsonData);
    }

    function renderTable(data) {
      const table = document.createElement('table');
      table.className = 'table table-bordered table-striped';

      data.forEach((row, i) => {
        const tr = document.createElement('tr');
        row.forEach(cell => {
          const cellEl = document.createElement(i === 0 ? 'th' : 'td');
          cellEl.textContent = cell != null ? cell : '';
          tr.appendChild(cellEl);
        });
        table.appendChild(tr);
      });

      const output = document.getElementById('output');
      output.innerHTML = '';
      output.appendChild(table);
    }
  </script>
</body>
</html>
