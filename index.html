<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Recherche C√¢ble</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="p-4 bg-light">
  <div class="container">
    <h1 class="mb-4">üîç Rechercher un c√¢ble</h1>

    <div class="input-group mb-4">
      <input type="text" id="cblInput" class="form-control" placeholder="Entrez le code CBL (ex: 436ACU02)">
      <button class="btn btn-primary" onclick="searchCable()">Rechercher</button>
    </div>

    <div id="resultArea"></div>
    <hr class="my-5">
    <a href="upload.html" class="btn btn-secondary">üì§ Mettre √† jour les donn√©es</a>
  </div>

  <script>
    let db;
    const request = indexedDB.open("CablesDB", 2);

    request.onsuccess = function(event) {
      db = event.target.result;
    };

    function searchCable() {
      const cblCode = document.getElementById('cblInput').value.trim().toUpperCase();
      if (!cblCode) {
        showError("Veuillez entrer un code CBL.");
        return;
      }

      const tx = db.transaction("cables", "readonly");
      const store = tx.objectStore("cables");
      const req = store.getAll();

      req.onsuccess = function() {
        const result = req.result.find(row => (row["CBL"] || "").toUpperCase() === cblCode);
        if (result) {
          renderCableCard(result);
        } else {
          showError(`Aucun c√¢ble trouv√© avec le code : ${cblCode}`);
        }
      };
    }

    function showError(msg) {
      document.getElementById('resultArea').innerHTML = `<div class="alert alert-danger">${msg}</div>`;
    }

    function renderCableCard(data) {
      const createField = (label, value) => `<div><strong>${label} :</strong> ${value || '-'}</div>`;

      const html = `
        <div class="card border-primary mb-4">
          <div class="card-header bg-primary text-white">üîå C√¢ble : ${data["CBL"] || "?"}</div>
          <div class="card-body">
            <h5 class="card-title mb-3">Appareil d'origine</h5>
            ${createField("Rep√®re", data["APP_ORIG"])}
            ${createField("Local", data["LOCAL_ORIG"])}
            ${createField("Lot √©tude", data["LOT_ETUDE_ORIG"])}
            ${createField("Hauteur", data["HAUTEUR_ORIG"])}
            ${createField("Couple", data["COUPLE_ORIG"])}
            ${createField("Distance/Axe", data["DIST_AXE_ORIG"])}
            ${createField("Type appareil", data["TYPE_APP_ORIG"])}
            ${createField("D√©signation", data["DESIG_APP_ORIG"])}
            <hr>
            <h5 class="card-title mb-3">Appareil d'arriv√©e</h5>
            ${createField("Rep√®re", data["APP_ARR"])}
            ${createField("Local", data["LOCAL_ARR"])}
            ${createField("Lot √©tude", data["LOT_ETUDE_ARR"])}
            ${createField("Hauteur", data["HAUTEUR_ARR"])}
            ${createField("Couple", data["COUPLE_ARR"])}
            ${createField("Distance/Axe", data["DIST_AXE_ARR"])}
            ${createField("Type appareil", data["TYPE_APP_ARR"])}
            ${createField("D√©signation", data["DESIG_APP_ARR"])}
            <hr>
            <h5 class="card-title mb-3">Infos g√©n√©rales</h5>
            ${createField("Fonction", data["FONCTION"])}
            ${createField("Nb c√¢bles en //", data["NB_CABLES_PARALLELE"])}
            ${createField("Statut bord", data["STATUT_BORD"])}
            ${createField("Plan", data["PLAN"])}
            ${createField("Date besoin", data["DATE_BESOIN"])}
            ${createField("Longueur coup√©e", data["LONGUEUR_COUP"])}
          </div>
        </div>
      `;

      document.getElementById('resultArea').innerHTML = html;
    }
  </script>
</body>
</html>
